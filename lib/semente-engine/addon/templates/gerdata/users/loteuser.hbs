<aside id="lote_user_modal" class="modal modal--is-show">
    <div class="modal__overlayer"></div>
    <div class="modal__content modal__content--lg mt4">
        <div class="modal__header">
            {{#link-to 'gerdata.users' model.instituicao.id}}
                <button class="modal__close btn-close icon-x"></button>
            {{/link-to}}
            <h3 class="modal__title">Cadastro de usuários em lote</h3>
        </div>

        <div class="modal__body modal__body--inside-scroll inside-scroll" style="max-height: 75vh;">
            <div class="inside-scroll__fixed">
                <p>Por meio dos botões abaixo, baixe o arquivo de carga, preencha-o, busque-o em seu computador e
                    realize o pré-processamento.</p>

                <div class="institutions__mass-enroll institutions__btn-group flow-h-sm">
                    <button class="btn btn-primary btn__claro" type="submit" {{action 'baixarTemplate' }}>
                        Baixar template
                    </button>
                    <span>
                        <img src="/assets/img/seta-lado.png" alt="">
                    </span>
                    <label class="btn label_get_lote" for="get_lote">Buscar arquivo</label>
                    <input id="get_lote" multiple="false" onchange={{action "buscarArquivo" }} 
                        accept="text/csv" type="file" style="display: none;" />

                    {{#if (equalstr selected_file '')}}
                        <button class="btn btn-primary btn--disabled" type="submit" disabled>
                            Pré processar
                        </button>
                    {{else}}
                        <button class="btn btn-primary" type="submit" {{action 'preImportarLote' }}>
                            Pré processar
                        </button>
                    {{/if}}

                    <div>
                        <i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="display: none" id="spinner-importar-lote"></i>
                    </div>
                </div>

                {{#if preProcessamento}}
                    <p>Após o pré-processamento do arquivo, certifique-se de que as turmas possuem os números corretos de alunos.</p>
                    <p>Se sim, clique no botão <b>Importar</b> localizado no final da página.</p>
                    <p>Se não, arrume o arquivo e realize o pré-processamento novamente.</p>
                {{/if}}

                {{!-- <div class="t-center instrucoes">
                    <p>Em caso de dúvidas, acesse o nosso passo a passo <span class="destaque"> clicando abaixo</span></p>
                    <div class="passoapasso" id="passoapasso">
                        <div class="passoapasso__imagem"></div>
                    </div>
                    <span {{action 'abrirPasso' }}>
                        <img class="seta" {{action 'giro' }} src="/assets/img/seta-baixo.png" alt="" id="seta">
                    </span>
                </div> --}}
            </div>

            <div class="inside-scroll__scroll">
            {{#if selected_file}}
                <div class="institutions__attached-file alert alert--sm alert--has-icon">
                    <span class="alert__icon icon-paperclip"></span>
                    <span class="institutions__attached-label">Arquivo selecionado: </span>
                    <strong>{{selected_file}}</strong>
                </div>
            {{/if}}
            {{#if error_lote}}
                <p>1- {{error_lote}}</p>
            {{/if}}
            {{#if wait_lote}}
                <p>Um momento...</p>
            {{else if erro_lista}}
                <p>2- {{erro_lista}}</p>
            {{else}}

            {{#if historyLote}}
                <table class="table table--striped table--mass-enroll">
                    <thead class="thead-dark">
                        <tr>
                            <th class="table__import" scope="col">Cadastrador</th>
                            <th class="table__file" scope="col">Arquivo</th>
                            <th class="table__import" scope="col">Importação</th>
                            <th class="table__import" scope="col">Status</th>
                            <th class="table__users" scope="col">Usuários</th>
                            <th class="table__users" scope="col">Processados</th>
                            <th class="table__not-processed" scope="col">Não Processados</th>
                            <th class="table__log" scope="col">Log</th>
                        </tr>
                    </thead>
                    <tbody class="gersistema-user-list-box">
                    {{#each lista_lote as |lista|}}
                        <tr>
                            <td class="table__import">{{lista.pessoaNome}}</td>
                            <td class="table__file">{{lista.nomeArquivo}}</td>
                            <td class="table__import">{{lista.data}}</td>
                            <td class="table__import">{{lista.status}}</td>
                            <td class="table__users">{{lista.quantidadeDeUsuarios}}</td>
                            <td class="table__users">{{lista.usuariosProcessados}}</td>
                            <td class="table__not-processed">{{lista.usuariosNaoProcessados}}</td>
                            <td class="table__log">
                            {{#if lista.link}}
                                <a href={{lista.link}}>
                                    <i class="icon-file-text"></i>
                                </a>
                            {{else}}
                                <i class="fa fa-times-o"></i>
                            {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                    </tbody>
                </table>
                {{/if}}

                {{#if preProcessamento}}
                    <table class="table table--striped table--mass-enroll table--mt">
                        <thead class="thead-dark">
                            <tr>
                                <th class="table__file" scope="col">Erro na planilha</th>
                                <th class="table__users" scope="col">Linha</th>
                            </tr>
                        </thead>
                        <tbody class="gersistema-user-list-box">
                        {{#each preProcessamentoData as |lista|}}
                            {{#if (equalstr lista.type "Planilha")}}
                                <tr>
                                    <td class="table__file">{{lista.erro}}</td>
                                    <td class="table__users">{{lista.linha}}</td>
                                </tr>
                            {{/if}}
                        {{/each}}
                        </tbody>
                    </table>
                    <table class="table table--striped table--mass-enroll table--mt">
                        <thead class="thead-dark">
                            <tr>
                                <th class="table__file" scope="col">Instituição</th>
                                <th class="table__import" scope="col">Ano</th>
                                <th class="table__users" scope="col">Turma</th>
                                <th class="table__users" scope="col">Alunos</th>
                            </tr>
                        </thead>
                        <tbody class="gersistema-user-list-box">
                        {{#each preProcessamentoData as |lista|}}
                            {{#if (equalstr lista.type "Turma")}}
                                <tr>
                                    <td class="table__file">{{lista.instituicao}}</td>
                                    <td class="table__import">{{lista.plataformaAno}}</td>
                                    <td class="table__users">{{lista.plataformaTurma}}</td>
                                    <td class="table__users">{{lista.alunos}}</td>
                                </tr>
                            {{/if}}
                        {{/each}}
                        </tbody>
                    </table>
                    <table class="table table--striped table--mass-enroll table--mt">
                        <thead class="thead-dark">
                            <tr>
                                <th class="table__file" scope="col">Nome</th>
                                <th class="table__import" scope="col">Erro</th>
                                <th class="table__users" scope="col">Perfil</th>
                                <th class="table__users" scope="col">Linha</th>
                            </tr>
                        </thead>
                        <tbody class="gersistema-user-list-box">
                        {{#each preProcessamentoData as |lista|}}
                            {{#if (equalstr lista.type "Pessoa")}}
                                <tr>
                                    <td class="table__file">{{lista.nome}}</td>
                                    <td class="table__import">{{lista.erro}}</td>
                                    <td class="table__users">{{lista.perfil}}</td>
                                    <td class="table__users">{{lista.linha}}</td>
                                </tr>
                            {{/if}}
                        {{/each}}
                        </tbody>
                    </table>
                    <div class="flex flex-col justify-content-end mt2">
                        <button class="btn" type="submit" {{action 'importarLote' }}>Importar</button>
                    </div>
                {{/if}}
            {{/if}}
            </div>
        </div>
    </div>
</aside>
{{loadInfo}}